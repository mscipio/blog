<h2>Dataset</h2>
<p>Dataset is the main object you will work with directly. Dataset is derived from python’s dict, so it inherits (and overrides some of) the methods of dict. In other words it is a collection of key:value pairs, where the key value is the DICOM (group,element) tag (as a Tag object, described below), and the value is a DataElement instance (also described below).</p>
<p>A dataset could be created directly, but you will usually get one by reading an existing DICOM file:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">pydicom</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span> <span class="o">=</span> <span class="n">pydicom</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="s">&quot;rtplan.dcm&quot;</span><span class="p">)</span> <span class="c"># (rtplan.dcm is in the testfiles directory)</span>
</pre>


<p>You can display the entire dataset by simply printing its string (str or repr) value:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0012</span><span class="p">)</span> <span class="n">Instance</span> <span class="n">Creation</span> <span class="n">Date</span>              <span class="n">DA</span><span class="p">:</span> <span class="s">&#39;20030903&#39;</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0013</span><span class="p">)</span> <span class="n">Instance</span> <span class="n">Creation</span> <span class="n">Time</span>              <span class="n">TM</span><span class="p">:</span> <span class="s">&#39;150031&#39;</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0016</span><span class="p">)</span> <span class="n">SOP</span> <span class="n">Class</span> <span class="n">UID</span>                       <span class="n">UI</span><span class="p">:</span> <span class="n">RT</span> <span class="n">Plan</span> <span class="n">Storage</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">001</span><span class="mi">8</span><span class="p">)</span> <span class="n">SOP</span> <span class="n">Instance</span> <span class="n">UID</span>                    <span class="n">UI</span><span class="p">:</span> <span class="mf">1.2</span><span class="o">.</span><span class="mf">777.777</span><span class="o">.</span><span class="mf">77.7</span><span class="o">.</span><span class="mf">7777.7777</span><span class="o">.</span><span class="mi">20030903150023</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0020</span><span class="p">)</span> <span class="n">Study</span> <span class="n">Date</span>                          <span class="n">DA</span><span class="p">:</span> <span class="s">&#39;20030716&#39;</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0030</span><span class="p">)</span> <span class="n">Study</span> <span class="n">Time</span>                          <span class="n">TM</span><span class="p">:</span> <span class="s">&#39;153557&#39;</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0050</span><span class="p">)</span> <span class="n">Accession</span> <span class="n">Number</span>                    <span class="n">SH</span><span class="p">:</span> <span class="s">&#39;&#39;</span>
<span class="p">(</span><span class="mo">000</span><span class="mi">8</span><span class="p">,</span> <span class="mo">0060</span><span class="p">)</span> <span class="n">Modality</span>                            <span class="n">CS</span><span class="p">:</span> <span class="s">&#39;RTPLAN&#39;</span>
</pre>


<p>You can access specific data elements by name (DICOM ‘keyword’) or by DICOM tag number:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">PatientName</span>
<span class="s">&#39;Last^First^mid^pre&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="p">[</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x10</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="s">&#39;Last^First^mid^pre&#39;</span>
</pre>


<p>In the latter case (using the tag number directly) a DataElement instance is returned, so the .value must be used to get the value.</p>
<p>You can also set values by name (DICOM keyword) or tag number:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">PatientID</span> <span class="o">=</span> <span class="s">&quot;12345&quot;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">SeriesNumber</span> <span class="o">=</span> <span class="mi">5</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="p">[</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x10</span><span class="p">]</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="s">&#39;Test&#39;</span>
</pre>


<p>The use of names is possible because Pydicom intercepts requests for member variables, and checks if they are in the DICOM dictionary. It translates the keyword to a (group,element) number and returns the corresponding value for that key if it exists.</p>
<p>DICOM Sequences are turned into python list s. Items in the sequence are referenced by number, beginning at index 0 as per python convention.:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">BeamSequence</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">BeamName</span>
<span class="s">&#39;Field 1&#39;</span>
</pre>


<p>Using DICOM keywords is the recommended way to access data elements, but you can also use the tag numbers directly, such as:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="c"># Same thing with tag numbers:</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="p">[</span><span class="mh">0x300a</span><span class="p">,</span><span class="mh">0xb0</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mh">0x300a</span><span class="p">,</span><span class="mh">0xc2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="s">&#39;Field 1&#39;</span>
<span class="o">&gt;&gt;&gt;</span> <span class="c"># yet another way, using another variable</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">beam1</span><span class="o">=</span><span class="n">ds</span><span class="p">[</span><span class="mh">0x300a</span><span class="p">,</span><span class="mh">0xb0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">beam1</span><span class="o">.</span><span class="n">BeamName</span><span class="p">,</span> <span class="n">beam1</span><span class="p">[</span><span class="mh">0x300a</span><span class="p">,</span><span class="mh">0xc2</span><span class="p">]</span><span class="o">.</span><span class="n">value</span>
<span class="p">(</span><span class="s">&#39;Field 1&#39;</span><span class="p">,</span> <span class="s">&#39;Field 1&#39;</span><span class="p">)</span>
</pre>


<p>If you don’t remember or know the exact tag name, Dataset provides a handy dir() method, useful during interactive sessions at the python prompt:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">ds</span><span class="o">.</span><span class="n">dir</span><span class="p">(</span><span class="s">&quot;pat&quot;</span><span class="p">)</span>
<span class="p">[</span><span class="s">&#39;PatientBirthDate&#39;</span><span class="p">,</span> <span class="s">&#39;PatientID&#39;</span><span class="p">,</span> <span class="s">&#39;PatientName&#39;</span><span class="p">,</span> <span class="s">&#39;PatientSetupSequence&#39;</span><span class="p">,</span> <span class="s">&#39;PatientSex&#39;</span><span class="p">]</span>
</pre>


<p>dir will return any DICOM tag names in the dataset that have the specified string anywhere in the name (case insensitive).</p>
<blockquote>
<p><strong>NOTE:</strong>
Calling dir with no string will list all tag names available in the dataset.
You can also see all the names that pydicom knows about by viewing the _dicom_dict.py file. You could &gt;modify that file to add tags that pydicom doesn’t already know about.</p>
</blockquote>
<p>Under the hood, Dataset stores a DataElement object for each item, but when accessed by name (e.g. ds.PatientName) only the value of that DataElement is returned. If you need the whole DataElement (see the DataElement class discussion), you can use Dataset’s data_element() method or access the item using the tag number:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">data_element</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">data_element</span><span class="p">(</span><span class="s">&quot;PatientsName&quot;</span><span class="p">)</span>  <span class="c"># or data_element = ds[0x10,0x10]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">data_element</span><span class="o">.</span><span class="n">VR</span><span class="p">,</span> <span class="n">data_element</span><span class="o">.</span><span class="n">value</span>
<span class="p">(</span><span class="s">&#39;PN&#39;</span><span class="p">,</span> <span class="s">&#39;Last^First^mid^pre&#39;</span><span class="p">)</span>
</pre>


<p>To check for the existence of a particular tag before using it, use the in keyword:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="s">&quot;PatientName&quot;</span> <span class="ow">in</span> <span class="n">ds</span>
<span class="bp">True</span>
</pre>


<p>To remove a data element from the dataset, use del:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="k">del</span> <span class="n">ds</span><span class="o">.</span><span class="n">SoftwareVersions</span>   <span class="c"># or del ds[0x0018, 0x1020]</span>
</pre>


<p>To work with pixel data, the raw bytes are available through the usual tag:</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">pixel_bytes</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">PixelData</span>
</pre>


<p>but to work with them in a more intelligent way, use pixel_array (requires the NumPy library):</p>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="n">pix</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">pixel_array</span>
</pre>


<p>For more details, see a future post [Working with Pixel Data.]</p>
<h2>DataElement</h2>
<p>The DataElement class is not usually used directly in user code, but is used extensively by Dataset. DataElement is a simple object which stores the following things:</p>
<ul>
<li><strong>tag</strong> – a DICOM tag (as a Tag object)</li>
<li><strong>VR</strong> – DICOM value representation – various number and string formats, etc</li>
<li><strong>VM</strong> – value multiplicity. This is 1 for most DICOM tags, but can be multiple, e.g. for coordinates. You do not have to specify this, the DataElement class keeps track of it based on value.</li>
<li><strong>value</strong> – the actual value. A regular value like a number or string (or list of them), or a Sequence.</li>
</ul>
<h2>Tag</h2>
<p>The Tag class is derived from python’s <em>int</em>, so in effect, it is just a number with some extra behaviour:</p>
<ul>
<li>Tag enforces that the DICOM tag fits in the expected 4-byte (group,element)</li>
<li>A Tag instance can be created from an int or from a tuple containing the (group,element) separately:</li>
</ul>
<pre class="code literal-block"><span class="o">&gt;&gt;&gt;</span> <span class="kn">from</span> <span class="nn">pydicom.tag</span> <span class="kn">import</span> <span class="n">Tag</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t1</span><span class="o">=</span><span class="n">Tag</span><span class="p">(</span><span class="mh">0x00100010</span><span class="p">)</span> <span class="c"># all of these are equivalent</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t2</span><span class="o">=</span><span class="n">Tag</span><span class="p">(</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x10</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t3</span><span class="o">=</span><span class="n">Tag</span><span class="p">((</span><span class="mh">0x10</span><span class="p">,</span> <span class="mh">0x10</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t1</span>
<span class="p">(</span><span class="mo">0010</span><span class="p">,</span> <span class="mo">0010</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">t1</span><span class="o">==</span><span class="n">t2</span><span class="p">,</span> <span class="n">t1</span><span class="o">==</span><span class="n">t3</span>
<span class="p">(</span><span class="bp">True</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
</pre>


<ul>
<li>Tag has properties group and element (or elem) to return the group and element portions</li>
<li>The is_private property checks whether the tag represents a private tag (i.e. if group number is odd).</li>
</ul>
<h2>Sequence</h2>
<p>Sequence is derived from python’s <em>list</em>. The only added functionality is to <strong>make string representations prettier</strong>. Otherwise all the usual methods of list like item selection, append, etc. are available.</p>